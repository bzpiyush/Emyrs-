{
    "version": "2.0.0",
    "inputs": [
        {
            "id": "scenario",
            "description": "Migration scenario to test",
            "type": "pickString",
            "options": [
                "single-vm",
                "pseudo-vip",
                "single-tenant-vmss",
                "standard-lb-vm-backend"
            ],
            "default": "single-vm"
        },
        {
            "id": "region",
            "description": "Azure region for deployment",
            "type": "pickString",
            "options": [
                "useast2euap",
                "uscentraleuap"
            ],
            "default": "uscentraleuap"
        },
        {
            "id": "resourceGroup",
            "description": "Resource group name",
            "type": "promptString",
            "default": "emyrs-test-rg"
        },
        {
            "id": "vmCount",
            "description": "Number of VMs (for multi-VM scenarios)",
            "type": "promptString",
            "default": "2"
        },
        {
            "id": "vmUniqueId",
            "description": "VM Unique ID (for Kusto query)",
            "type": "promptString",
            "default": ""
        },
        {
            "id": "tenantName",
            "description": "Tenant Name (from Kusto query)",
            "type": "promptString",
            "default": ""
        },
        {
            "id": "fabricId",
            "description": "Fabric ID / ClusterName (from Kusto query)",
            "type": "promptString",
            "default": ""
        },
        {
            "id": "subscriptionId",
            "description": "Azure Subscription ID",
            "type": "promptString",
            "default": ""
        }
    ],
    "tasks": [
        {
            "label": "ðŸš€ Emyrs: Deploy Test Resources",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/Deploy-TestResources.ps1",
            "args": [
                "-Scenario", "${input:scenario}",
                "-ResourceGroupName", "${input:resourceGroup}",
                "-Location", "${input:region}",
                "-VmCount", "${input:vmCount}"
            ],
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new"
            },
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": "ðŸ” Emyrs: Query Kusto for Tenant Info",
            "type": "shell",
            "command": "Write-Host 'Run this query in Kusto Explorer or Azure Data Explorer:' -ForegroundColor Cyan; Write-Host \"`ncluster('azcore.centralus.kusto.windows.net').database('AzureCP').`nMycroftContainerSnapshot_Latest`n| where VirtualMachineUniqueId == '${input:vmUniqueId}'`n| project Cluster, TenantName, ClusterName\" -ForegroundColor Yellow",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new"
            }
        },
        {
            "label": "ðŸ“ Emyrs: Generate AzMove Script",
            "type": "shell",
            "command": "Write-Host '# ============ AZMOVE MIGRATION SCRIPT ============' -ForegroundColor Cyan; Write-Host \"`n# Run this on SAW machine after taking JIT access`n`n`$AzMove = Get-AzMove -Name ${input:region}-prod-b`n`n`$crpSubscriptionId = '${input:subscriptionId}'`n`$tenantName = '${input:tenantName}'`n`$fabricId = '${input:fabricId}'`n`n`$migrationInput = New-AzMoveObject AzMove.Controller.MigrateRunningTenantToMerlinInput`n`$migrationInput | Update-AzMoveObject -PropertyName FabricId -PropertyValue `$fabricId`n`$migrationInput | Update-AzMoveObject -PropertyName NrpSubscriptionId -PropertyValue `$crpSubscriptionId`n`$migrationInput | Update-AzMoveObject -PropertyName RegionalNetworkResourceChannelType -PropertyValue 'ViaPubSub'`n`$migrationInput | Update-AzMoveObject -PropertyName VipGoalStateChannelType -PropertyValue 'ViaPubSub'`n`$migrationInput | Update-AzMoveObject -PropertyName RollbackMode -PropertyValue 'Optimized'`n`n# VALIDATE FIRST!`n`$result = (`$AzMove | Invoke-AzMoveApi -MethodName AzMoveService_ValidateMigrateRunningTenantToMerlinAsyncByCrpsubscriptionidTenantnameMigrationinputAsync -Parameters @(`$crpSubscriptionId, `$tenantName, `$migrationInput)).Result`n`n# THEN MIGRATE (after validation passes)`n# `$result = (`$AzMove | Invoke-AzMoveApi -MethodName AzMoveService_MigrateRunningTenantToMerlinAsyncByCrpsubscriptionidTenantnameMigrationinputAsync -Parameters @(`$crpSubscriptionId, `$tenantName, `$migrationInput)).Result\" -ForegroundColor White",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new"
            }
        },
        {
            "label": "ðŸ”Ž Emyrs: Check Migration Status (Kusto Query)",
            "type": "shell",
            "command": "Write-Host 'Run this query in Kusto to check migration status:' -ForegroundColor Cyan; Write-Host \"`nAzMoveDiagnostics`n| where PreciseTimeStamp > ago(1d)`n| where * contains '${input:tenantName}'`n| order by PreciseTimeStamp desc`n| limit 50\" -ForegroundColor Yellow",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new"
            }
        },
        {
            "label": "ðŸ§¹ Emyrs: Cleanup Resources",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/Cleanup-TestResources.ps1",
            "args": [
                "-ResourceGroupName", "${input:resourceGroup}"
            ],
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new"
            }
        }
    ]
}
